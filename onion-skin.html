<link rel="import" href="../polymer/polymer.html">

<!--
Element providing a way to diff between images using the "onion skin" method.
You feed it image elements, then drag the slider to cross-fade between them.

##### Example

    <onion-skin>
      <img src="image1.png">
      <img src="image2.png">
    </onion-skin>

@element onion-skin
@blurb Element providing a way to diff between images using the "onion skin" method.
@status alpha
@homepage http://oslego.github.io/onion-skin
-->
<polymer-element name="onion-skin" attributes="author">

  <template>

    <link rel="stylesheet" href="onion-skin.css" />

    <div class="tool-container" layout vertical>

      <div class="frames-container" self-center>
        <content select="img" id="images"></content>
      </div>

      <input class="slider" type="range" max="{{maxOpacity}}" min="0" value="{{currentOpactiy}}" id="opacity" />

    </div>

  </template>

  <script>

    Polymer('onion-skin', {

      author: 'Razvan Caliman',

      domReady: function(){
        // store distributed images as an array
        this.frames = Array.prototype.slice.call(this.$.images.getDistributedNodes());
        this.maxOpacity = (this.frames.length - 1) * 100;
      },

      ready: function() {
        this.currentOpactiy = 0;
        this.maxOpacity = 0;
        this.frames = [];
      },

      observe: {
        '$.opacity.value': 'opacityChanged'
      },

      opacityChanged: function(oldValue, newValue) {
        if (!this.frames.length){
          return
        }

        var value = parseInt(newValue, 10),
            i, len, opacity;

        for (i = 0, len = this.frames.length; i < len; i++) {
          opacity = (value + 100 - i * 100) / 100;

          // fade back out; optional but useful for imgs with transparency to avoid visible stacking
          if (opacity > 1){
            opacity = (2 - opacity)
          }

          // clamp opacity value to 0..1
          opacity = Math.min(1, Math.max(0, opacity));

          // TODO: store style state in JS and avoid updating DOM with duplicate values #webperf
          this.frames[i].style.opacity = opacity;
        }
      },

      /**
       * The `seed-element-lasers-success` event is fired whenever we
       * call fireLasers.
       *
       * @event seed-element-lasers-success
       * @param {Object} detail
       *   @param {string} detail.sound An amazing sound.
       */

      /**
       * The `fireLasers` method will fire the lasers. At least
       * it will dispatch an event that claims lasers were fired :)
       *
       * @method fireLasers
       */
      fireLasers: function() {
        this.fire('seed-element-lasers-success', { sound: 'Pew pew pew!' });
      }

    });

  </script>

</polymer-element>
